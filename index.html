<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>CRUD Users Vue2 + Tailwind</title>

<!-- Vue 2 -->
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-100">

<div id="app" class="max-w-4xl mx-auto p-6">

  <!-- HEADER -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800">CRUD Users</h1>
    <p class="text-gray-500">Express + Sequelize + MySQL</p>
  </div>

  <!-- FORM CARD -->
  <div class="bg-white rounded-xl shadow p-6 mb-6">
    <h2 class="font-semibold mb-4 text-lg">
      {{ form.id ? 'Edit User' : 'Tambah User' }}
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <input v-model="form.name"
             placeholder="Nama"
             class="border rounded-lg px-3 py-2 w-full focus:ring focus:ring-blue-200">

      <input v-model="form.email"
             placeholder="Email"
             class="border rounded-lg px-3 py-2 w-full focus:ring focus:ring-blue-200">

      <div class="flex gap-2">
        <button @click="saveUser"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg w-full">
          Simpan
        </button>

        <button v-if="form.id"
          @click="resetForm"
          class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg w-full">
          Batal
        </button>
      </div>
    </div>
  </div>

  <!-- TABLE CARD -->
  <div class="bg-white rounded-xl shadow overflow-hidden">
    <div class="p-4 border-b font-semibold">
      Data Users
    </div>

    <div v-if="loading" class="p-6 text-center text-gray-500">
      Loading data...
    </div>

    <table v-else class="w-full">
      <thead class="bg-gray-50">
        <tr>
          <th class="p-3 text-left">ID</th>
          <th class="p-3 text-left">Nama</th>
          <th class="p-3 text-left">Email</th>
          <th class="p-3 text-left w-40">Aksi</th>
        </tr>
      </thead>

      <tbody>
        <tr v-for="u in users" :key="u.id"
            class="border-t hover:bg-gray-50">
          <td class="p-3">{{ u.id }}</td>
          <td class="p-3">{{ u.name }}</td>
          <td class="p-3">{{ u.email }}</td>
          <td class="p-3 flex gap-2">

            <button @click="editUser(u)"
              class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm">
              Edit
            </button>

            <button @click="deleteUser(u.id)"
              class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
              Hapus
            </button>

          </td>
        </tr>

        <tr v-if="users.length === 0">
          <td colspan="4" class="text-center p-6 text-gray-500">
            Tidak ada data
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<script>
new Vue({
  el: '#app',

  data: {
    api: 'http://localhost:3000/users',
    users: [],
    loading: false,

    form: {
      id: null,
      name: '',
      email: ''
    }
  },

  methods: {

    // =========================
    // LOAD DATA
    // =========================
    async loadUsers() {
      this.loading = true;
      const res = await fetch(this.api);
      this.users = await res.json();
      this.loading = false;
    },


    // =========================
    // CREATE / UPDATE
    // =========================
    async saveUser() {

      if (!this.form.name || !this.form.email) {
        alert('Nama dan email wajib diisi');
        return;
      }

      const payload = {
        name: this.form.name,
        email: this.form.email
      };

      if (this.form.id) {
        // UPDATE
        await fetch(this.api + '/' + this.form.id, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      } else {
        // CREATE
        await fetch(this.api, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      }

      this.resetForm();
      this.loadUsers();
    },


    // =========================
    // EDIT
    // =========================
    editUser(u) {
      this.form = {
        id: u.id,
        name: u.name,
        email: u.email
      };
      window.scrollTo({ top: 0, behavior: 'smooth' });
    },


    // =========================
    // DELETE
    // =========================
    async deleteUser(id) {
      if (!confirm('Yakin hapus data?')) return;

      await fetch(this.api + '/' + id, {
        method: 'DELETE'
      });

      this.loadUsers();
    },


    // =========================
    // RESET FORM
    // =========================
    resetForm() {
      this.form = {
        id: null,
        name: '',
        email: ''
      };
    }

  },

  mounted() {
    this.loadUsers();
  }

});
</script>

</body>
</html>
